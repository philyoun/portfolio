---
title: "12 Tidy data"
output: github_document
---
## 12.1 Introduction

> "행복한 가정은 다 비슷비슷하다. 모든 불행한 가정은 다 가지각색으로 불행하다." - 레오 톨스토이
> "Tidy 데이터셋은 다 비슷비슷하다. 모든 지저분한 데이터들은 다 가지각색으로 지저분하다." - Hadley Wickham

이 chapter에서는, R의 데이터를 organise하는 consistent 방법에 대해서 배울 것이다. <br />
이 구조가 tidy data이다.

너의 데이터를, 이러한 포맷으로 만드는건 선불의upfront 작업을 필요로 한다. 근데 가치가 있는 일임.
이러한 tidy data랑 tidy tools를 잘 쓰면, 데이터를 어떠한 표현에서 다른 표현으로 개조하는데에,
시간을 훨씬 적게 쓰게 될거다. 그리고 그만큼 분석하는데에 시간을 더 쓸 수 있고.

이 단원은 tidy data에 대한 실용적인 소개와 tidyr에 딸려있는 도구들에 대해 설명

### 12.1.1 Prerequisites
tidyr이라는 패키지를 사용할 것인데, 이건 tidyverse의 코어 중 하나다. 
그래서 tidyverse만 로드하면 된다.
```{r warning=FALSE, message=FALSE}
library(tidyverse)
```

## 12.2 Tidy data
같은 데이터를 여러가지 방법으로 표현represent할 수 있다.
다음 예는 같은 데이터를 4가지 다른 방법으로 organise하는 것을 보여준다.
각 데이터셋은 4가지 변수country, year, population, cases에 대한 같은 값을 보여주지만, 
	다른 방법으로 organise되어있다.
```{r collapse=TRUE}
table1
table2
table3

# 2개의 tibble에 나누어서 표현되어 있는,
table4a
table4b
```
다 같은 데이터에 대한 표현인데, 다 똑같이 사용하기 쉬운건 아니다.
하나의 데이터셋인, 'tidy 데이터셋'이, tidyverse안에서 작업하기 훨씬 쉽다.

dataset을 tidy하게 만드는 3가지 interrelated rules가 있다.
1. 각 변수는 항상 own 칼럼을 가져야 한다.
2. 각 관측치는 항상 own 행을 가져야 한다.
3. 각 값은 항상 own 셀을 가져야 한다.
Figure 12.1가 이걸 visually하게 보여준다.
![Figure 12.1](https://d33wubrfki0l68.cloudfront.net/6f1ddb544fc5c69a2478e444ab8112fb0eea23f8/91adc/images/tidy-1.png)

3개의 룰 : 변수는 칼럼에, 관측치는 행에, 값은 cell에.

이 3가지 룰은 interrelated되어있다. 왜냐하면 3개 중에 2개만 갖는 것은 불가능하기 때문.
그래서, 다음과 같이 더 간단한 실용적인 룰들을 정할 수 있다.

1. 각 데이터셋을 tibble에다 넣어라.
2. 각 변수를 칼럼에다 넣어라.
이 예시에서, `table1`만이 tidy하다. each column이 변수인 유일한 표현이다.

왜 tidy하게 만들어야 되냐? 2가지 장점이 있다.
1. 데이터를 저장하는데 있어, one consistent way를 정하는거에 일반적인 장점이 있다.
만약 너가 일관성 있는 데이터 구조를 갖고 있다면, 
	underlying하는 통일성이 있어서, 그걸 다루는 툴을 배우는게 쉽다.

2. 변수를 칼럼에다 놓으면, 특정한 장점이 있다. 왜냐하면 이게 R의 벡터화된 본성이 빛나게 하기 때문.
mutate와 summary functions에서 배웠듯이, 거의 모든 R built-in 함수들은 벡터의 값들과 연동.
그래서, tidy data를 transforming하는게 특히나 자연스럽게 느껴지게 된다.

tidyverse에 있는 dplyr, ggplot2 그리고 다른 패키지들은 tidy data와 작업할 수 있게끔 디자인되었다.
table1과 어떻게 작업할 수 있는지, 예들이 있음.

```{r collapse=TRUE}
# rate per 10,000을 구하고 싶다면,
table1 %>%
	mutate(rate = cases / population * 10000)

# cases per year을 구하고 싶다면
table1 %>%
	count(year, wt = cases)

# visualise changes over time을 하고 싶다면
ggplot(table1, aes(year, cases)) +
	geom_line(aes(group = country), color = "grey50") +
	geom_point(aes(colour = country))
```




























