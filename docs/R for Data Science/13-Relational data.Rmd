---
title: "13-Relational Data"
output:
  md_document:
    variant: markdown_github
---

# 13 Relational data

## 13.1 Introduction
데이터 분석을 하는데 있어, 단 하나의 table을 쓰는 경우는 거의 없다. <br />
보통 여러 개의 테이블들이 있고, 니가 궁금한 것에 대해 대답을 하기 위해선, 이것들을 잘 결합combine해야됨. <br />
종합해서, 이 multiple tables of data를 relational data라고 부른다. <br />
단순히 개별적인 데이터셋들이 아니라, relations가 중요하기 때문이다.

Relations라는건, 항상 2개의 테이블에서 정의되는거다. <br />
모든 relations들은 이 간단한 아이디어에서 만들어진 것. <br />
3개 이상의 테이블에서의 relations라는건 항상 2개씩의 relations의 특성. 확장의 개념으로 생각하자. <br />
the relations of three or more tables / are always a property of the relations between each pair.

Relational data에 대해 다루기 위해서는, pairs of tables에 사용되는 verbs를 알아야됨. <br />
3가지의 families of verbs가 있음.

- Mutating joins: 하나의 데이터 프레임에 새로운 변수들을 추가하는 것. <br />
&emsp;&emsp;&emsp;&emsp;어떤 새로운 변수? 다른 데이터 프레임에서, 매칭이 되는 관측치에 대한 변수 <br />
&emsp;&emsp;&emsp;&emsp;which add new variables to one data frame / from matching observations in another. <br />
- Filtering joins: 하나의 데이터 프레임에서 관측치를 필터링 하는 것임. <br />
&emsp;&emsp;&emsp;&emsp;어떤 기준으로? 다른 데이터 프레임에, 그 관측치에 대한 정보가 있냐없냐에 따라 <br />
&emsp;&emsp;&emsp;&emsp;which filter observations from one data frame / based on whether or not they match an observation in the other table.
- Set Operations: 관측치를 set elements였던 것처럼 다루는 것. <br />
&emsp;&emsp;&emsp;&emsp;which treat observations as if they were set elements.

Relational data를 찾을 수 있는 가장 흔한 장소는 relational database management system(RDBMS)이다. <br />
거의 모든 현대 데이터베이스들을 관통하는 단어. <br /> 
만약에 데이터베이스를 다루어본 적이 있다면, 아마 분명히 SQL을 썼을 것이다. <br />
그렇다면, 이 챕터에서 비슷한 개념을 찾을 수 있을 것이다. 물론 표현은 dplyr에선 좀 다르겠지만. <br />
일반적으로, dplyr은 SQL보다 좀 더 사용하기 쉽다. 왜냐하면 데이터 분석에 특화되어있기 때문에. <br />
보통의 데이터 분석 작업을 쉽게 만들어 주는데, 데이터 분석에 잘 이용되지 않는 다른 것들은 하기가 좀 힘들어지긴 한다. <br />
it makes common data analysis operations easier, at the expense of making it more difficult to do other things to do other things that aren't commonly needed for data analysis.

### 13.1.1 Prerequisites
dplyr에서 two-table verbs를 사용함으로써, `nycflights13`의 relational data를 다루어보자. <br />
```{r echo=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(nycflights13)
```

## 13.2 nycflights13
relational data를 배우기 위해서 nycflights13 패키지를 사용할 것이다. <br />
이 패키지는 4개의 tibbles를 갖고 있다. <br />
이 tibbles는, data transformation을 할 때 썼던, `flights`라는 테이블과 연관이 있는 tibble들.

`airlines`: 항공사 이름을 단축된 코드로 볼 수 있도록 해준다.
```{r}
airlines
```
`airports`: 각 공항에 대한 정보를 준다. `faa`라는 airport code로 identify가능.
```{r}
airports
```
`planes`: 각 비행기 정보를 준다. `tailnum`로 identify가능.
```{r}
planes
```
`weather`: NYC 공항에서의 시간별 날씨를 준다.
```{r}
weather
```

다이어그램으로 이 테이블들 간의 관계를 표시했는데,
![그림1](https://d33wubrfki0l68.cloudfront.net/245292d1ea724f6c3fd8a92063dcd7bfb9758d02/5751b/diagrams/relational-nycflights.png)

다이어그램은 좀 복잡하긴한데, 필드에 나가서 보게 될 것에 비하면 간단한 편! <br />
이러한 다이어그램을 이해하는 것의 key는, 각 relation은 한 쌍의 테이블만을 고려한다는 것. <br />
The key to understanding diagrams like this / is to remember / each relation always concerns a pair of tables. <br />
다 이해할 필요는 없고, 테이블 간의 (니가 관심있는)chain of relations만 이해해라.

이 nycflights13에 관해선, <br />
`flights`는 `planes`와 하나의 변수인, `tailnum`을 통해 연결된다. <br />
`flights`는 `airlines`와 `carrier` 변수를 통해 연결된다. <br />
`flights`는 `airports`와 두 가지 방법, `origin`과 `dest` 변수들을 통해 연결된다. <br />
`flights`는 `weather`와, `origin`(출발지), `year`, `month`, `day` 그리고 `hour`를 통해 연결된다.

## 13.3 Keys
2개의 tables를 연결시켜주는 변수들을, **keys**라고 부른다. <br />
keys는 관측치를 unique하게 identify해주는 변수(혹은 변수들). <br />
간단한 케이스들에서는, 하나의 변수가 관측치를 identify하기에 충분하다.
























